FORMAT: 1A
HOST: https://syrup.keboola.com/ex-youtube

# Youtube Extractor configuration
---

# Authentication
POST/GET on /oauth endpoint
Must contain *token* and *config* parameters, where *config* is a table(must already exist) name of the particular configuration.

# Config table
## Attributes

OAuth information generated by /oauth endpoint

## Data
- Columns:
    - **api**: [data,analytics] the extractor can connect to both data and analytics API. Therefore you can perform a call on the data API to retrieve a list of channels for an account, and then retrieve analytics data for all channels listed by the data call.
    - **endpoint**(required): The API endpoint
    - **params**: Query parameters of the api call, JSON encoded
        - Each parameter in the JSON encoded object may either contain a string, eg: `{""start-date"": ""2014-12-26""}`
        - What data is extracted from Analytics API is configured using [metrics](https://developers.google.com/youtube/analytics/v1/dimsmets/mets) and [dimensions](https://developers.google.com/youtube/analytics/v1/dimsmets/dims) at the **reports** endpoint. There are 4 required params for reports: **ids**, **start-date**, **end-date**, **metrics**. To tweak the export to your needs, use the [API inspector](https://developers.google.com/apis-explorer/#p/youtubeAnalytics/v1/youtubeAnalytics.reports.query?ids=contentOwner%253D%253DYourUser&start-date=2014-01-01&end-date=2015-02-01&metrics=views%252CimpressionBasedCpm&dimensions=day&filters=channel%253D%253DUCFdsfiewfehfhqhfeqhfehq&_h=2&) to see what data it has to offer and then translate its configuration to the params field. Channel IDs can be obtained from [data API](https://developers.google.com/apis-explorer/#p/youtube/v3/youtube.channels.list?part=id%252Csnippet&managedByMe=true&onBehalfOfContentOwner=BlueSkyFilm&_h=1&)
        - [Code builder](http://docs.genericrestextractor.apiary.io/#introduction/user-functions) is supported.
    - **dataType**: Type of data returned by the endpoint. It also describes a table name, where the results will be stored
    - **dataField**: Allows to override which field of the response will be exported. Only used with **data** API
        - If there's multiple arrays in the response "root" the extractor may not know which array to export and fail
        - If the response is an array, the whole response is used by default
        - If there's no array within the root, the path to response data **must** be specified in *dataField*
        - Can contain a path to nested value, dot separater (eg `result.results.products`)
    - **recursionParams**: A Json encoded additional configuration for recursion.
        - Currently only "filter" key is supported, which should contain a value consisting of a name of a field from the parent's response, logical operator and a value to compare against. Supported operators are "**=**", "**<**", "**>**", "**<=**", "**>=**", "**!=**"
        - Example: `type != employee` or `product.value > 150`
    - **rowId**(required): An unique identificator of the configuration row

### Example data

    "endpoint","params","dataType","dataField","recursionParams","rowId","api"
    "reports?filters=channel=={channels:id}","{""ids"":""contentOwner==BlueSkyFilm"",
    ""metrics"":""views,comments,impressionBasedCpm,impressions"",
    ""dimensions"":""day"",
    ""start-date"":""2014-01-01"",
    ""end-date"":""2015-01-01""
    }","all_chan_stats","","","2","analytics"
    "channels","{
    ""part"":""id,snippet"",
    ""managedByMe"":""true"",
    ""onBehalfOfContentOwner"":""BlueSkyFilm""
    }","","","","channels","data"

# Group API

## Extractor run [/run]

### Run extraction [POST]

JSON Parameters:

- **config** (required) ... configuration id (name of configuration table)

+ Request (application/json)

    + Headers

            Accept: application/json
            X-StorageApi-Token: Your-Sapi-Token

    + Body

            {
                "config": "main"
            }

    + Schema

            {
                "type": "object",
                "required": true,
                "properties": {
                    "config": {
                        "type": "string",
                        "required": true
                    }
                }
            }

+ Response 201 (application/json)

        {
            "id": "48419532",
            "url": "https://syrup.keboola.com/queue/job/48419532",
            "status": "waiting"
        }


## Generate OAuth token [/oauth{?token,config}]

### Generate token from a web form/UI [POST]

+ Parameters
    + token = `` (required, string, `305-78945-rg48re4g86g48gwgr48e6`) ... Your KBC Token

    + config = `` (required, string, `main`) ... Config table name / configuration ID

+ Request (multipart/form-data; boundary=----WebKitFormBoundaryC5GD12ZfR1D8yZIt)
    + Body

            ------WebKitFormBoundaryC5GD12ZfR1D8yZIt
            Content-Disposition: form-data; name="token"

            305-78954-d54f6ew4f84ew6f48ewq4f684q
            ------WebKitFormBoundaryC5GD12ZfR1D8yZIt--

            ------WebKitFormBoundaryC5GD12ZfR1D8yZIt
            Content-Disposition: form-data; name="config"

            main
            ------WebKitFormBoundaryC5GD12ZfR1D8yZIt--

    + Schema

            {
                "type": "object",
                "required": true,
                "properties": {
                    "config": {
                        "type": "string",
                        "required": true
                    }
                    "token": {
                        "type": "string",
                        "required": true
                    }
                }
            }

+ Response 201 (application/json)

        {
            "status": "ok"
        }

### Generate token manually [GET]

+ Parameters
    + token = `` (required, string, `305-78945-rg48re4g86g48gwgr48e6`) ... Your KBC Token

    + config = `` (required, string, `main`) ... Config table name / configuration ID

+ Response 201 (application/json)

        {
            "status": "ok",
            "oauth_token": "dsjioafhoiy832yt598y7895y",
            "oauth_token_secret": "kf98v0894u8j580jy8902xyjciurewc"
        }
